<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VMicroscope Beta Testing</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous" />
  <link rel="stylesheet" href="utils.css">
  <style>
    img {
      max-width: 100%;
      max-height: 100%;
    }

    .container .text-light{
      margin-top: 5rem;
    }

    .canvas{
      display: flex;
      justify-content: space-between;
      padding: 5px;
      overflow: hidden;
      position: relative;
    }

    .img {
      max-width: 30vw;
      height: 30vw;
      border: 3px solid black;
      border-radius: 50%;
    }

    .microscopeRotation {
      margin: 5px;
      /* margin-top: 2rem;
      margin-bottom: 2rem;                 no need as already from bootstrap css*/
      /* width: 50%; */
      align-items: center;
      /* border: 10px rgb(0, 0, 0) solid;  no need as already from bootstrap css*/
      display: flex;
      flex-direction: column;
      padding: 2rem;
    }

    .mineralName {
      font-size: 40px;
      font-style: italic;
      margin-bottom: 2rem;
    }

    #view {
      font-size: 20px;
      margin-top: 1rem;
    }

    .thinSection{
      margin: 5px;
      padding: 5px;
      overflow: hidden;
    }

    .thinSection .thinSection-image{
      bottom: 0px;
      position: relative;
    }

    .thinSection .thinSection-buttons{
      position: absolute;
      top: 0px;
      display: flex;
      justify-content: space-between;
      flex-direction: row;
    }

    .thinSection-buttons button{
      border: 0px;
      padding: 2rem;
      color: white;
      background: rgba(0, 128, 0, 0.342);
      text-align: center;
      font-size: large;
    }

    .thinSection-buttons button:hover{
      background: rgba(113, 1, 13, 0.342);
    }

  </style>

</head>

<body class="bg-secondary" id="body">
  <nav class="navbar navbar-expand-lg bg-light bg-dark fixed-top">
    <div class="container-fluid">
      <a class="navbar-brand text-bg-light p-2 rounded-2 fw-bolder" href="./index.html">V-M</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link active text-light" aria-current="page" href="./index.html">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-light" href="sector2.html">Link</a>
          </li>
        </ul>
        <form class="d-flex" role="search">
          <input class="form-control me-2" type="search" placeholder="Search Rocks" aria-label="Search" />
          <button class="btn btn-outline-success bg-success text-white" type="submit">
            Search
          </button>
        </form>
      </div>
    </div>
  </nav>

  <div class="container text-center d-block">
    <h1 class="text-light">Virtual Microscope Simulation Device</h1>
  </div>
  <div class="canvas main">

    <div class="microscopeRotation border border-dark rounded-start border-0 position-relative text-center w-50 m-2 mt-5 bg-white">
      <img class="img" src="./photos/test 2 cropped/image0051 Cropped.jpg" alt="#"
        style="visibility: hidden; z-index: 1;">
      <img class="img" src="./photos/test 2 cropped/image0052 Cropped.jpg" alt="#"
        style="visibility: hidden; position: absolute; z-index: 2">
      <img class="img" src="./photos/test 2 cropped/image0053 Cropped.jpg" alt="#"
        style="visibility: hidden; position: absolute; z-index: 3">
      <img class="img" src="./photos/test 2 cropped/image0054 Cropped.jpg" alt="#"
        style="visibility: hidden; position: absolute; z-index: 4">
      <img class="img" src="./photos/test 2 cropped/image0055 Cropped.jpg" alt="#"
        style="visibility: hidden; position: absolute; z-index: 5">
      <img class="img" src="./photos/test 2 cropped/image0056 Cropped.jpg" alt="#"
        style="visibility: hidden; position: absolute; z-index: 6">
      <img class="img" src="./photos/test 2 cropped/image0057 Cropped.jpg" alt="#"
        style="visibility: hidden; position: absolute; z-index: 7">
      <img class="img" src="./photos/test 2 cropped/image0058 Cropped.jpg" alt="#"
        style="visibility: hidden; position: absolute; z-index: 8">
      <img class="img" src="./photos/test 2 cropped/image0059 Cropped.jpg" alt="#"
        style="visibility: hidden; position: absolute; z-index: 9">
      <img class="img" src="./photos/test 2 cropped/image0060 Cropped.jpg" alt="#"
        style="visibility: hidden; position: absolute; z-index: 10">
      <img class="img" src="./photos/test 2 cropped/image0061 Cropped.jpg" alt="#"
        style="visibility: hidden; position: absolute; z-index: 11">
      <img class="img" src="./photos/test 2 cropped/image0062 Cropped.jpg" alt="#"
        style="visibility: hidden; position: absolute; z-index: 12">
      <img class="img" src="./photos/test 2 cropped/image0063 Cropped.jpg" alt="#"
        style="visibility: hidden; position: absolute; z-index: 13">
      <img class="img" src="./photos/test 2 cropped/image0064 Cropped.jpg" alt="#"
        style="visibility: hidden; position: absolute; z-index: 14">
      <img class="img" src="./photos/test 2 cropped/image0065 Cropped.jpg" alt="#"
        style="visibility: hidden; position: absolute; z-index: 15">
      <img class="img" src="./photos/test 2 cropped/image0066 Cropped.jpg" alt="#"
        style="visibility: hidden; position: absolute; z-index: 16">
      <img class="img" src="./photos/test 2 cropped/image0067 Cropped.jpg" alt="#"
        style="visibility: hidden; position: absolute; z-index: 17">
      <img class="img" src="./photos/test 2 cropped/image0068 Cropped.jpg" alt="#"
        style="visibility: hidden; position: absolute; z-index: 18">
      <img class="img" src="./photos/test 2 cropped/image0069 Cropped.jpg" alt="#"
        style="visibility: hidden; position: absolute; z-index: 19">
        <div id="view"></div>
      <div class="mineralName">#gabbro sector 1</div>
    </div>

    <div class="thinSection m-5 w-50">
      <div class="thinSection-image">
        <img src="./photos/thin_section_comp.JPG" alt="">
        <div class="thinSection-buttons w-100">
           <a href="index.html"><button>A</button></a>
           <a href="sector2.html"><button>B</button></a>
           <a href="sector3.html"><button>C</button></a>
        </div>
      </div>
    </div>

  </div>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
    crossorigin="anonymous"></script>
  <script>
    img = document.querySelectorAll(".img");
    bdy = document.getElementById("body");
    view = document.getElementById("view");

    s = Array.from(img);
    var index = 0,
      count = 0,
      opac = 0,
      angle = 0;

    function Start() {
      for (let i = 0; i < s.length; i++) {
        s[i].style.visibility = `hidden`;
      }

      s[0].style.visibility = `visible`;
      s[1].style.visibility = `visible`;
      s[1].style.rotate = `-10deg`;
      s[0].style.opacity = 1;
      s[1].style.opacity = 0;
      count = 0;
      angle = 0;
      opac = 0;
      index = 0;
      view.innerText = angle + " deg";
    }

    Start();

    function reStart() {
      console.log("restarted");
      for (let i = 0; i < s.length; i++) {
        s[i].style.visibility = `hidden`;
        s[i].style.rotate = `180deg`;
      }
      s[0].style.visibility = `visible`;
      s[1].style.visibility = `visible`;
      s[1].style.rotate = `-10deg`;
      s[0].style.opacity = 1;
      s[1].style.opacity = 0;
      count = 0;
      //angle = 180;
      opac = 0;
      index = 0;
      view.innerText = angle + " deg";
    }

    function reBack() {
      console.log("reback is called");
      s[index].style.visibility = `hidden`;
      s[index + 1].style.visibility = `hidden`;
      index = 17;
      count = 10;
      opac = 1;
      s[index + 1].style.visibility = `visible`;
      s[index].style.visibility = `visible`;
      s[index].style.rotate = `10deg`;
      s[index + 1].style.opacity = 1;
      s[index].style.opacity = 1;
      console.log(count + " " + opac + " " + angle + " " + index + " reback");
    }

    function img_change_clock_rotation(i) {
      if (i < 18) {
        console.log("forward function called for index = " + i);

        if (angle < 180) {
          s[i].style.rotate = `${count}deg`;
          s[i + 1].style.rotate = `${count - 10}deg`;
          s[i + 1].style.opacity = `${opac}`;
          console.log(count + " " + opac + " " + angle + " " + i + " f");
          view.innerText = angle + " deg";
        } else {
          s[i].style.rotate = `${count + 180}deg`;
          s[i + 1].style.rotate = `${count + 180 - 10}deg`;
          s[i + 1].style.opacity = `${opac}`;
          console.log(count + " " + opac + " " + angle + " " + i + " f");
          view.innerText = angle + " deg";
        }
        opac = 0;
        count = 0;
        index++;
        if (index == 18) reStart();
        console.log("index change to " + index);
        console.log(count + " " + opac + " " + angle + " " + i);

        if (index > 0)
          // edge case for index = 0 and user presses key = 37.
          s[index - 1].style.visibility = `hidden`;
        //   if (index < 16)
        //     // edge case for index = 16 and index = 17.
        //     s[index + 2].style.visibility = `hidden`;
        s[index].style.visibility = `visible`;
        s[index + 1].style.visibility = `visible`;
        s[index + 1].style.rotate = `-10deg`;
        s[index].style.opacity = 1;
        s[index + 1].style.opacity = 0;
      } else return;
    }

    function img_change_antiClock_rotation(i) {
      if (i >= 0 && i < 18) {
        console.log("backward function called for index = " + i);

        if (angle < 180) {
          s[i].style.rotate = `${count}deg`;
          s[i + 1].style.rotate = `${count - 10}deg`;
          s[i + 1].style.opacity = `${opac}`;
          console.log(count + " " + opac + " " + angle + " " + i + "b");
          view.innerText = angle + " deg";
        } else {
          s[i].style.rotate = `${count + 180}deg`;
          s[i + 1].style.rotate = `${count + 180 - 10}deg`;
          s[i + 1].style.opacity = `${opac}`;
          console.log(count + " " + opac + " " + angle + " " + i + "b");
          view.innerText = angle + " deg";
        }

        opac = 1;
        count = 10;
        index--;
        if (index == -1) Start();
        console.log("index change to " + index);
        s[index + 2].style.visibility = `hidden`;
        s[index].style.visibility = `visible`;
        s[index].style.opacity = 1;
        if (index > 0)
          s[index + 1].style.opacity = 1;
      } else return;
    }

    function callAt11() {
      console.log("callAt11 is called");
      index++;
      if (index == 18) {
        for (let i = 0; i < s.length; i++) {
          s[i].style.visibility = `hidden`;
          s[i].style.rotate = `180deg`;
        }
        index = 0;
      }

      if (index > 0)
        s[index - 1].style.visibility = `hidden`;
      s[index].style.visibility = `visible`;
      s[index + 1].style.visibility = `visible`;
      s[index + 1].style.rotate = `-10deg`;
      s[index].style.opacity = 1;
      s[index + 1].style.opacity = 0;
      count = 1;
      opac = 0.1;
      if (angle < 180) {
        s[index].style.rotate = `${count}deg`;
        s[index + 1].style.rotate = `${count - 10}deg`;
        s[index + 1].style.opacity = `${opac}`;
        console.log(count + " " + opac + " " + angle + " " + index + "f");
        view.innerText = angle + " deg";
      } else {
        s[index].style.rotate = `${count + 180}deg`;
        s[index + 1].style.rotate = `${count + 180 - 10}deg`;
        s[index + 1].style.opacity = `${opac}`;
        console.log(count + " " + opac + " " + angle + " " + index + "f");
        view.innerText = angle + " deg";
      }
    }

    function callAtNeg1() {
      console.log("callAtNeg1 is called");
      index--;
      if (index == -1) index = 17;
      if (index < 17)
        s[index + 2].style.visibility = `hidden`;
      s[index].style.visibility = `visible`;
      s[index + 1].style.visibility = `visible`;
      count = 9;
      opac = 0.9;
      if (angle < 180) {
        s[index].style.rotate = `${count}deg`;
        s[index + 1].style.rotate = `${count - 10}deg`;
        s[index + 1].style.opacity = `${opac}`;
        console.log(count + " " + opac + " " + angle + " " + index + "b");
        view.innerText = angle + " deg";
      } else {
        s[index].style.rotate = `${count + 180}deg`;
        s[index + 1].style.rotate = `${count + 180 - 10}deg`;
        s[index + 1].style.opacity = `${opac}`;
        console.log(count + " " + opac + " " + angle + " " + index + "b");
        view.innerText = angle + " deg";
      }
    }

    function reStartAt360() {
      for (let i = 0; i < s.length; i++) {
        s[i].style.visibility = `hidden`;
        s[i].style.rotate = `179deg`;
      }
      s[17].style.visibility = `visible`;
      s[18].style.visibility = `visible`;
      s[17].style.rotate = `10deg`;
      s[17].style.opacity = 1
        ;
      s[18].style.opacity = 0.9;
      count = 9;
      //angle = 180;
      opac = 0.9;
      index = 17;
      angle = 359;
      view.innerText = angle + " deg";
    }

    bdy.addEventListener("keydown", (i) => {
      if (count >= 0 && count <= 10) {
        if (i.keyCode === 39) {
          count++;
          angle++;
          opac = opac + 0.1;
          if (angle == 360) Start();
          if (count == 11) callAt11(i);
          else if (count == 10) {
            // case for clockwise rotation.
            img_change_clock_rotation(index);
          } else {
            if (angle <= 180) {
              s[index].style.rotate = `${count}deg`;
              s[index + 1].style.rotate = `${count - 10}deg`;
            } else {
              console.log("working after 180");
              s[index].style.rotate = `${count + 180}deg`;
              s[index + 1].style.rotate = `${count + 180 - 10}deg`;
            }
            s[index + 1].style.opacity = `${opac}`;
            console.log(count + " " + opac + " " + angle + " " + index);
            view.innerText = angle + " deg";
          }
        } else if (i.keyCode === 37) {
          count--;
          angle--;
          opac = opac - 0.1;
          if (angle == -1) reStartAt360();
          if (angle == 180) reBack();
          if (count == -1) callAtNeg1();
          else if (count == 0) {
            // case for anti clockwise rotation.
            img_change_antiClock_rotation(index);
          } else {
            //if(angle == 179) reBack();
            if (angle <= 180) {
              s[index].style.rotate = `${count}deg`;
              s[index + 1].style.rotate = `${count - 10}deg`;
            } else {
              console.log("working after 180");
              s[index].style.rotate = `${count + 180}deg`;
              s[index + 1].style.rotate = `${count + 180 - 10}deg`;
            }

            s[index + 1].style.opacity = `${opac}`;
            console.log(count + " " + opac + " " + angle + " " + index);
            view.innerText = angle + " deg";
          }
        }
      }
    });
  </script>
</body>

</html>